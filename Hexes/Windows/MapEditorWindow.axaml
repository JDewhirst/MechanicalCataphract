<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:GUI.ViewModels"
        mc:Ignorable="d" d:DesignWidth="300" d:DesignHeight="600"
        x:Class="GUI.MapEditorWindow"
        x:DataType="vm:HexMapViewModel"
        Title="Map Editor"
        Width="300" Height="600"
        WindowStartupLocation="CenterOwner">

    <ScrollViewer>
        <StackPanel Spacing="10" Margin="10">
            <!-- Tool Selection -->
            <TextBlock Text="Tools" FontWeight="Bold" FontSize="14"/>
            <WrapPanel Orientation="Horizontal">
                <ToggleButton Content="Terrain" Margin="2"
                              Command="{Binding TerrainPaintToolCommand}"
                              IsChecked="{Binding CurrentTool,
                                          Converter={StaticResource EqualityConverter},
                                          ConverterParameter=TerrainPaint,
                                          Mode=OneWay}"/>
                <ToggleButton Content="Road" Margin="2"
                              Command="{Binding RoadPaintToolCommand}"
                              IsChecked="{Binding CurrentTool,
                                          Converter={StaticResource EqualityConverter},
                                          ConverterParameter=RoadPaint,
                                          Mode=OneWay}"/>
                <ToggleButton Content="River" Margin="2"
                              Command="{Binding RiverPaintToolCommand}"
                              IsChecked="{Binding CurrentTool,
                                          Converter={StaticResource EqualityConverter},
                                          ConverterParameter=RiverPaint,
                                          Mode=OneWay}"/>
                <ToggleButton Content="Location" Margin="2"
                              Command="{Binding LocationPaintToolCommand}"
                              IsChecked="{Binding CurrentTool,
                                          Converter={StaticResource EqualityConverter},
                                          ConverterParameter=LocationPaint,
                                          Mode=OneWay}"/>
                <ToggleButton Content="Erase" Margin="2"
                              Command="{Binding EraseToolCommand}"
                              IsChecked="{Binding CurrentTool,
                                          Converter={StaticResource EqualityConverter},
                                          ConverterParameter=Erase,
                                          Mode=OneWay}"/>
                <ToggleButton Content="Faction" Margin="2"
                              Command="{Binding FactionControlPaintToolCommand}"
                              IsChecked="{Binding CurrentTool,
                                          Converter={StaticResource EqualityConverter},
                                          ConverterParameter=FactionControlPaint,
                                          Mode=OneWay}"/>
            </WrapPanel>

            <Separator/>

            <!-- Hex Size -->
            <StackPanel Orientation="Horizontal" Spacing="5">
                <TextBlock Text="Hex Size:" VerticalAlignment="Center"/>
                <NumericUpDown Value="{Binding HexRadius, Mode=TwoWay}"
                               Minimum="10" Maximum="50" Increment="5"
                               Width="120"/>
            </StackPanel>

            <Separator/>

            <!-- Brush Size -->
            <StackPanel Orientation="Horizontal" Spacing="5">
                <TextBlock Text="Brush size:" VerticalAlignment="Center"/>
                <NumericUpDown Value="{Binding BrushSize, Mode=TwoWay}"
                               Minimum="1" Maximum="10" Increment="1"
                               Width="120"/>
            </StackPanel>

            <Separator/>

            <!-- Terrain Palette -->
            <TextBlock Text="Terrain Types" FontWeight="Bold" FontSize="14"/>
            <ListBox ItemsSource="{Binding TerrainTypes}"
                     SelectedItem="{Binding SelectedTerrainType}"
                     MaxHeight="250">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                            <Border Width="20" Height="20" CornerRadius="3"
                                    BorderBrush="Black" BorderThickness="1">
                                <Border.Background>
                                    <SolidColorBrush Color="{Binding ColorHex}"/>
                                </Border.Background>
                            </Border>
                            <Image Width="20" Height="20" Stretch="Uniform"
                                   Source="{Binding IconPath, Converter={StaticResource StringToBitmapConverter}}"
                                   IsVisible="{Binding IconPath, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                            <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <Separator/>

            <!-- Location Palette -->
            <TextBlock Text="Location Types" FontWeight="Bold" FontSize="14"/>
            <ListBox ItemsSource="{Binding LocationTypes}"
                     SelectedItem="{Binding SelectedLocationType}"
                     MaxHeight="150">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                            <Border Width="20" Height="20" CornerRadius="3"
                                    BorderBrush="Black" BorderThickness="1">
                                <Border.Background>
                                    <SolidColorBrush Color="{Binding ColorHex,
                                                                     TargetNullValue=#808080,
                                                                     FallbackValue=#808080}"/>
                                </Border.Background>
                            </Border>
                            <Image Width="20" Height="20" Stretch="Uniform"
                                   Source="{Binding IconPath, Converter={StaticResource StringToBitmapConverter}}"
                                   IsVisible="{Binding IconPath, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                            <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <Separator/>

            <!-- Population Density Palette -->
            <TextBlock Text="Population Density" FontWeight="Bold" FontSize="14"/>
            <ToggleButton Content="Population Brush" Margin="2"
                          Command="{Binding PopulationPaintToolCommand}"
                          IsChecked="{Binding CurrentTool,
                                      Converter={StaticResource EqualityConverter},
                                      ConverterParameter=PopulationPaint,
                                      Mode=OneWay}"/>
            <WrapPanel Orientation="Horizontal" Margin="0,4,0,0">
                <Button Content="20" Margin="2" Width="45"
                        Command="{Binding SetPopulationDensityCommand}"
                        CommandParameter="20"/>
                <Button Content="40" Margin="2" Width="45"
                        Command="{Binding SetPopulationDensityCommand}"
                        CommandParameter="40"/>
                <Button Content="60" Margin="2" Width="45"
                        Command="{Binding SetPopulationDensityCommand}"
                        CommandParameter="60"/>
                <Button Content="80" Margin="2" Width="45"
                        Command="{Binding SetPopulationDensityCommand}"
                        CommandParameter="80"/>
                <Button Content="100" Margin="2" Width="45"
                        Command="{Binding SetPopulationDensityCommand}"
                        CommandParameter="100"/>
            </WrapPanel>
            <TextBlock Text="{Binding SelectedPopulationDensity, StringFormat='Selected: {0}'}"
                       FontSize="11" Foreground="Gray"/>

            <Separator/>

            <!-- Faction Palette -->
            <TextBlock Text="Factions" FontWeight="Bold" FontSize="14"/>
            <ListBox ItemsSource="{Binding Factions}"
                     SelectedItem="{Binding SelectedFactionForPainting}"
                     MaxHeight="150">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                            <Border Width="20" Height="20" CornerRadius="3"
                                    BorderBrush="Black" BorderThickness="1">
                                <Border.Background>
                                    <SolidColorBrush Color="{Binding ColorHex,
                                                                     TargetNullValue=#808080,
                                                                     FallbackValue=#808080}"/>
                                </Border.Background>
                            </Border>
                            <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <Separator/>

            <!-- Status -->
            <TextBlock Text="Status" FontWeight="Bold" FontSize="14"/>
            <TextBlock Text="{Binding StatusMessage}" TextWrapping="Wrap"/>
        </StackPanel>
    </ScrollViewer>
</Window>
